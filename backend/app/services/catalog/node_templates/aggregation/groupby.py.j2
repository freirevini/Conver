{# 
  GroupBy Template
  Groups and aggregates DataFrame
#}
def node_{{ node_id }}_groupby(
    input_0: pd.DataFrame,
    *,
    {% if settings.group_columns %}
    group_columns: list = {{ settings.group_columns | tojson }},
    {% else %}
    group_columns: list = [],
    {% endif %}
    {% if settings.aggregations %}
    aggregations: dict = {{ settings.aggregations | tojson }},
    {% else %}
    aggregations: dict = {},
    {% endif %}
) -> pd.DataFrame:
    """
    {{ node_name }}
    KNIME Node ID: {{ node_id }}
    Factory: {{ factory_class }}
    
    Groups by columns and applies aggregations.
    """
    df = input_0.copy()
    
    if not group_columns:
        logger.warning("No group columns specified, returning original DataFrame")
        return df
    
    # Validate columns exist
    valid_group_cols = [c for c in group_columns if c in df.columns]
    if not valid_group_cols:
        logger.warning(f"No valid group columns found in {df.columns.tolist()}")
        return df
    
    # Build aggregation dict
    if aggregations:
        # aggregations format: {"column": "agg_func"} or {"column": ["agg1", "agg2"]}
        agg_dict = {}
        for col, agg in aggregations.items():
            if col in df.columns:
                agg_dict[col] = agg
        
        if agg_dict:
            df = df.groupby(valid_group_cols, as_index=False).agg(agg_dict)
        else:
            df = df.groupby(valid_group_cols, as_index=False).first()
    else:
        # Default: count
        df = df.groupby(valid_group_cols, as_index=False).size()
        df = df.rename(columns={"size": "count"})
    
    logger.debug(f"GroupBy: {len(input_0)} -> {len(df)} rows")
    return df
